<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DentVantage Â· FinanÄnÃ­ Agent v3</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Mono:ital,wght@0,300;0,400;0,500;1,400&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#080b10;--surf:#0f1420;--surf2:#141c2e;--surf3:#1a2338;
  --border:#1e2d47;--border2:#243356;
  --blue:#00c8f0;--purple:#8b5cf6;--green:#0fd494;--gold:#f5a623;--red:#f43f5e;
  --white:#e8f0fe;--dim:#4a6080;--muted:#2a3a54;
  --ff:'Syne',sans-serif;--fm:'DM Mono',monospace;
}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:var(--ff);background:var(--bg);color:var(--white);min-height:100vh;overflow-x:hidden}
body::before{content:'';position:fixed;inset:0;z-index:0;
  background:radial-gradient(ellipse 80% 50% at 20% 20%,rgba(0,200,240,.06),transparent 60%),
  radial-gradient(ellipse 60% 40% at 80% 80%,rgba(139,92,246,.05),transparent 60%),
  linear-gradient(rgba(0,200,240,.02) 1px,transparent 1px),
  linear-gradient(90deg,rgba(0,200,240,.02) 1px,transparent 1px);
  background-size:100%,100%,44px 44px,44px 44px;pointer-events:none}
.wrap{position:relative;z-index:1;max-width:1340px;margin:0 auto;padding:0 28px}

header{position:sticky;top:0;z-index:200;background:rgba(8,11,16,.9);backdrop-filter:blur(24px);
  border-bottom:1px solid var(--border);padding:14px 0}
.hd{display:flex;align-items:center;justify-content:space-between}
.logo{display:flex;align-items:center;gap:10px}
.logo-mark{width:34px;height:34px;background:linear-gradient(135deg,var(--blue),var(--purple));
  border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:17px}
.logo-name{font-size:17px;font-weight:800;letter-spacing:-.5px}
.logo-name span{color:var(--blue)}
.tag{font-family:var(--fm);font-size:10px;background:rgba(0,200,240,.08);
  border:1px solid rgba(0,200,240,.22);color:var(--blue);padding:3px 9px;border-radius:20px}
.api-status{display:flex;align-items:center;gap:6px;font-family:var(--fm);font-size:10px}
.led{width:7px;height:7px;border-radius:50%;background:var(--dim)}
.led.on{background:var(--green);box-shadow:0 0 8px var(--green);animation:blink 2s infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.4}}

.prac-banner{background:var(--surf);border:1px solid var(--border);border-radius:16px;
  padding:22px 28px;margin:28px 0;display:flex;align-items:center;justify-content:space-between;
  flex-wrap:wrap;gap:16px;position:relative;overflow:hidden}
.prac-banner::before{content:'';position:absolute;inset:0;
  background:linear-gradient(90deg,rgba(0,200,240,.04),transparent 60%)}
.prac-name{font-size:18px;font-weight:700;margin-bottom:3px}
.prac-meta{font-family:var(--fm);font-size:11px;color:var(--dim)}
.kpi-row{display:flex;gap:24px;flex-wrap:wrap}
.kpi{text-align:right}
.kv{font-family:var(--fm);font-size:21px;font-weight:400;line-height:1.1;letter-spacing:-1px}
.kl{font-size:10px;color:var(--dim);text-transform:uppercase;letter-spacing:.8px;margin-top:2px}

.tabs{display:flex;border-bottom:1px solid var(--border);margin-bottom:28px;overflow-x:auto}
.tab{padding:14px 22px;font-size:12px;font-weight:700;color:var(--dim);cursor:pointer;
  border-bottom:2px solid transparent;transition:all .2s;white-space:nowrap;letter-spacing:.3px;text-transform:uppercase}
.tab:hover{color:var(--white)}
.tab.active{color:var(--blue);border-bottom-color:var(--blue)}
.tn{display:inline-flex;align-items:center;justify-content:center;width:16px;height:16px;
  background:var(--muted);border-radius:4px;font-size:9px;margin-right:6px;color:var(--white)}
.tab.active .tn{background:var(--blue);color:#000}

.panel{display:none}
.panel.active{display:block;animation:fadeUp .25s ease}
@keyframes fadeUp{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}

.g2{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px}
.g3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:20px;margin-bottom:20px}
@media(max-width:960px){.g2,.g3{grid-template-columns:1fr}}

.card{background:var(--surf);border:1px solid var(--border);border-radius:14px;padding:22px;
  position:relative;overflow:hidden;transition:border-color .2s}
.card:hover{border-color:var(--border2)}
.card::after{content:'';position:absolute;top:0;left:0;right:0;height:1px;
  background:linear-gradient(90deg,transparent,var(--blue),transparent);opacity:0;transition:opacity .3s}
.card:hover::after{opacity:.6}
.ct{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:1.2px;
  color:var(--dim);margin-bottom:14px;display:flex;align-items:center;gap:7px}

.ptable{width:100%;border-collapse:collapse}
.ptable th{font-family:var(--fm);font-size:9px;font-weight:400;color:var(--dim);
  text-transform:uppercase;letter-spacing:.8px;padding:8px 10px;text-align:left;
  border-bottom:1px solid var(--border)}
.ptable td{padding:11px 10px;font-size:12px;border-bottom:1px solid rgba(30,45,71,.5)}
.ptable tr:last-child td{border-bottom:none}
.ptable tr:hover td{background:rgba(255,255,255,.02)}
.pn{font-weight:600}
.pcat{font-family:var(--fm);font-size:9px;background:var(--surf2);border:1px solid var(--border);
  padding:2px 5px;border-radius:3px;color:var(--dim);display:inline-block;margin-top:2px}
.mn{font-family:var(--fm)}

.mbar{display:flex;align-items:center;gap:8px}
.mbar-bg{flex:1;height:3px;background:var(--border);border-radius:2px;overflow:hidden}
.mbar-fill{height:100%;border-radius:2px}
.mv{font-family:var(--fm);font-size:11px;font-weight:500;min-width:40px;text-align:right}

.badge{display:inline-flex;align-items:center;gap:3px;padding:2px 7px;border-radius:5px;
  font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:.4px}
.b-gold{background:rgba(245,166,35,.1);color:var(--gold);border:1px solid rgba(245,166,35,.25)}
.b-green{background:rgba(15,212,148,.1);color:var(--green);border:1px solid rgba(15,212,148,.25)}
.b-avg{background:rgba(74,96,128,.15);color:var(--dim);border:1px solid var(--border)}
.b-red{background:rgba(244,63,94,.1);color:var(--red);border:1px solid rgba(244,63,94,.25)}

.ins{display:flex;gap:10px;align-items:flex-start;background:var(--surf2);
  border:1px solid var(--border);border-radius:10px;padding:13px 15px;margin-bottom:10px}
.ii{width:30px;height:30px;border-radius:8px;display:flex;align-items:center;
  justify-content:center;font-size:14px;flex-shrink:0}
.ii-g{background:rgba(15,212,148,.12)}.ii-gld{background:rgba(245,166,35,.12)}
.ii-r{background:rgba(244,63,94,.12)}.ii-b{background:rgba(0,200,240,.12)}
.il{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:1px;
  color:var(--dim);margin-bottom:3px}
.it{font-size:12px;line-height:1.55}

.proc-row{display:flex;align-items:center;gap:10px;padding:11px 16px;
  border-bottom:1px solid rgba(30,45,71,.4);transition:background .15s}
.proc-row:hover{background:rgba(255,255,255,.02)}
.proc-row:last-child{border-bottom:none}
.prn{flex:1;font-size:12px;font-weight:600}
.prc{font-family:var(--fm);font-size:9px;color:var(--dim);display:block;margin-top:1px}

.pi{background:rgba(0,200,240,.06);border:1px solid rgba(0,200,240,.2);border-radius:7px;
  padding:5px 8px;color:var(--blue);font-family:var(--fm);font-size:12px;font-weight:500;
  width:88px;text-align:right;outline:none;transition:border-color .2s,box-shadow .2s}
.pi:focus{border-color:var(--blue);box-shadow:0 0 0 3px rgba(0,200,240,.12)}
.vi{background:rgba(139,92,246,.06);border:1px solid rgba(139,92,246,.2);border-radius:7px;
  padding:5px 8px;color:var(--purple);font-family:var(--fm);font-size:12px;font-weight:500;
  width:56px;text-align:right;outline:none}
input[type=number]::-webkit-inner-spin-button{-webkit-appearance:none}
input[type=number]{-moz-appearance:textfield}

.rkpi{background:var(--surf2);border:1px solid var(--border);border-radius:10px;padding:14px 18px;margin-bottom:12px}
.rkl{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--dim);margin-bottom:6px}
.rkv{font-family:var(--fm);font-size:28px;font-weight:400;line-height:1;letter-spacing:-1.5px}

.dr{display:flex;justify-content:space-between;align-items:center;
  padding:9px 0;border-bottom:1px solid rgba(30,45,71,.4);font-size:12px}
.dr:last-child{border-bottom:none}
.dl{color:var(--dim)}
.dv{font-family:var(--fm);font-weight:500}
.dp{color:var(--green)}.dn{color:var(--red)}.d0{color:var(--white)}

.pot{background:linear-gradient(135deg,rgba(0,200,240,.06),rgba(139,92,246,.06));
  border:1px solid rgba(0,200,240,.15);border-radius:14px;padding:22px 26px;
  margin-bottom:22px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:16px}
.pt{font-size:14px;font-weight:600}
.ps{font-size:12px;color:var(--dim);margin-top:3px}
.pn2{font-family:var(--fm);font-size:40px;font-weight:400;color:var(--green);
  letter-spacing:-2px;line-height:1}
.pnl{font-size:10px;color:var(--dim);letter-spacing:.8px;text-transform:uppercase}

.cf-wrap{display:flex;align-items:flex-end;gap:6px;height:160px;
  border-bottom:1px solid var(--border);padding:16px 0 0;margin-bottom:10px}
.cf-col{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:flex-end;height:100%}
.cf-bw{position:relative;width:100%;display:flex;flex-direction:column;align-items:stretch;justify-content:flex-end}
.cf-br{border-radius:3px 3px 0 0;background:rgba(0,200,240,.15);border:1px solid rgba(0,200,240,.25);width:100%}
.cf-bp{position:absolute;bottom:0;left:0;right:0;border-radius:3px 3px 0 0}
.cf-tt{position:absolute;bottom:calc(100% + 6px);left:50%;transform:translateX(-50%);
  background:var(--surf2);border:1px solid var(--border);border-radius:7px;
  padding:5px 9px;font-family:var(--fm);font-size:10px;white-space:nowrap;
  pointer-events:none;opacity:0;transition:opacity .15s;z-index:10}
.cf-col:hover .cf-tt{opacity:1}
.cf-mo{font-family:var(--fm);font-size:9px;color:var(--dim);margin-top:5px}

.bw{background:var(--surf);border:1px solid var(--border);border-radius:14px;overflow:hidden}
.bh{padding:14px 18px;border-bottom:1px solid var(--border);background:var(--surf2);
  display:flex;align-items:center;gap:10px}
.bav{width:34px;height:34px;background:linear-gradient(135deg,var(--purple),var(--blue));
  border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:16px}
.bhn{font-size:13px;font-weight:700}
.bhs{font-size:10px;color:var(--green)}
.bmsgs{height:320px;overflow-y:auto;padding:18px;display:flex;flex-direction:column;gap:14px}
.msg{display:flex;gap:9px;align-items:flex-start}
.msg.user{flex-direction:row-reverse}
.mav{width:26px;height:26px;border-radius:50%;display:flex;align-items:center;
  justify-content:center;font-size:12px;flex-shrink:0}
.mav.b{background:linear-gradient(135deg,var(--purple),var(--blue))}
.mav.u{background:var(--surf3);border:1px solid var(--border)}
.mb{max-width:78%;background:var(--surf2);border:1px solid var(--border);
  border-radius:11px;padding:11px 14px;font-size:12px;line-height:1.6}
.msg.user .mb{background:rgba(0,200,240,.06);border-color:rgba(0,200,240,.18)}
.hb{color:var(--blue);font-weight:700}.hg{color:var(--green);font-weight:700}
.hgld{color:var(--gold);font-weight:700}.hr{color:var(--red);font-weight:700}
.typ{display:flex;gap:3px;align-items:center;padding:3px 0}
.typ span{width:5px;height:5px;border-radius:50%;background:var(--dim);animation:ty 1.1s infinite}
.typ span:nth-child(2){animation-delay:.18s}.typ span:nth-child(3){animation-delay:.36s}
@keyframes ty{0%,60%,100%{opacity:.3}30%{opacity:1}}
.bir{padding:14px 18px;border-top:1px solid var(--border);display:flex;gap:8px}
.bi{flex:1;background:var(--surf2);border:1px solid var(--border);border-radius:9px;
  padding:9px 13px;color:var(--white);font-family:var(--ff);font-size:12px;outline:none;transition:border-color .2s}
.bi:focus{border-color:var(--blue)}
.bi::placeholder{color:var(--dim)}
.sbtn{background:linear-gradient(135deg,var(--blue),var(--purple));border:none;
  border-radius:9px;padding:9px 18px;color:#000;font-family:var(--ff);font-size:12px;
  font-weight:700;cursor:pointer;transition:opacity .2s}
.sbtn:hover{opacity:.85}
.qqs{display:flex;flex-wrap:wrap;gap:7px;padding:0 18px 12px}
.qq{background:var(--surf2);border:1px solid var(--border);border-radius:20px;
  padding:5px 11px;font-size:11px;cursor:pointer;color:var(--dim);transition:all .18s}
.qq:hover{border-color:var(--blue);color:var(--blue);background:rgba(0,200,240,.05)}

.alog{background:var(--surf);border:1px solid var(--border);border-radius:14px;overflow:hidden}
.alogh{padding:12px 16px;border-bottom:1px solid var(--border);background:var(--surf2);
  font-family:var(--fm);font-size:10px;color:var(--dim);display:flex;align-items:center;gap:8px}
.alogb{padding:12px 16px;height:280px;overflow-y:auto;font-family:var(--fm);
  font-size:10px;display:flex;flex-direction:column;gap:5px}
.le{display:flex;gap:10px;align-items:baseline}
.lt{color:var(--dim);min-width:58px}
.lm{padding:1px 5px;border-radius:3px;font-size:9px;font-weight:700}
.lm-p{background:rgba(15,212,148,.15);color:var(--green)}
.lm-g{background:rgba(0,200,240,.15);color:var(--blue)}
.lpath{color:var(--white)}
.lst{margin-left:auto;color:var(--green)}
.lms{color:var(--dim);font-size:9px}
::-webkit-scrollbar{width:4px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px}
.card,.pot{animation:cardIn .35s ease both}
@keyframes cardIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:none}}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="hd">
      <div class="logo">
        <div class="logo-mark">&#x1F9B7;</div>
        <div class="logo-name">Dent<span>Vantage</span></div>
        <div class="tag">FINANÄŒNÃAGENT v3 HYBRID</div>
      </div>
      <div class="api-status">
        <div class="led" id="led"></div>
        <span id="api-txt" style="color:var(--dim)">Kontroluji APIâ€¦</span>
      </div>
    </div>
  </div>
</header>

<div class="wrap" style="padding-top:24px;padding-bottom:60px">

<div class="prac-banner">
  <div>
    <div class="prac-name">MUDr. Praxe Â· Vinohrady, Praha</div>
    <div class="prac-meta">16 procedur Â· ReÃ¡lnÃ¡ data ze Ses_it1.xlsx Â· Ãšnor 2026</div>
  </div>
  <div class="kpi-row">
    <div class="kpi"><div class="kv" style="color:var(--blue)" id="k-rev">680 000 KÄ</div><div class="kl">MÄ›s. pÅ™Ã­jmy</div></div>
    <div class="kpi"><div class="kv" id="k-profit" style="color:var(--dim)">1 085 KÄ</div><div class="kl">MÄ›s. zisk</div></div>
    <div class="kpi"><div class="kv" style="color:var(--gold)" id="k-margin">0.2%</div><div class="kl">ÄŒistÃ¡ marÅ¾e</div></div>
    <div class="kpi"><div class="kv" style="color:var(--red)" id="k-alerts">5</div><div class="kl">ZtrÃ¡tovÃ½ch</div></div>
  </div>
</div>

<div class="tabs">
  <div class="tab active" onclick="sw('overview',this)"><span class="tn">1</span>PÅ™ehled</div>
  <div class="tab" onclick="sw('whatif',this)"><span class="tn">2</span>What-If Engine</div>
  <div class="tab" onclick="sw('cashflow',this)"><span class="tn">3</span>Cash Flow</div>
  <div class="tab" onclick="sw('buddy',this)"><span class="tn">4</span>Buddy Chat</div>
  <div class="tab" onclick="sw('apilog',this)"><span class="tn">5</span>API Live Log</div>
</div>

<!-- PANEL 1: PÅ˜EHLED -->
<div id="p-overview" class="panel active">
  <div class="pot">
    <div><div class="pt">&#x1F4A1; Optimalizace cenÃ­ku â€” okamÅ¾itÃ¡ pÅ™Ã­leÅ¾itost</div>
    <div class="ps">5 procedur prodÃ¡vÃ¡no pod nÃ¡klady. PÅ™i doporuÄenÃ½ch cenÃ¡ch (30% marÅ¾e):</div></div>
    <div><div class="pn2">+127 308 KÄ</div><div class="pnl">RoÄnÃ­ potenciÃ¡l</div></div>
  </div>
  <div class="g3">
    <div class="card"><div class="ct">â­ ZlatÃ© procedury</div><div id="golden-list"></div></div>
    <div class="card"><div class="ct">ğŸš¨ ZtrÃ¡tovÃ© procedury</div><div id="loss-list"></div></div>
    <div class="card"><div class="ct">ğŸ“Š Distribuce marÅ¾Ã­</div><div id="dist-bars"></div></div>
  </div>
  <div class="card">
    <div class="ct">ğŸ“‹ VÅ¡echny procedury â€” seÅ™azeno dle KÄ/hod</div>
    <table class="ptable">
      <thead><tr><th>#</th><th>Procedura</th><th>Cena</th><th>NÃ¡klady</th><th>MarÅ¾e</th><th>KÄ/hod</th><th>Klasifikace</th></tr></thead>
      <tbody id="proc-tbody"></tbody>
    </table>
  </div>
</div>

<!-- PANEL 2: WHAT-IF -->
<div id="p-whatif" class="panel">
  <div class="g2" style="margin-bottom:0">
    <div class="card" style="padding:0">
      <div style="padding:16px 20px;border-bottom:1px solid var(--border)">
        <div class="ct" style="margin:0">âœï¸ Uprav ceny &amp; objemy â€” pÅ™epoÄÃ­tÃ¡ se okamÅ¾itÄ›</div>
      </div>
      <div style="display:grid;grid-template-columns:1fr 94px 64px;padding:8px 16px;
          border-bottom:1px solid var(--border);font-size:9px;text-transform:uppercase;
          letter-spacing:.8px;color:var(--dim)">
        <span>VÃ½kon</span><span style="text-align:right">Cena (KÄ) âœï¸</span>
        <span style="text-align:right;margin-left:8px">Ks/mÄ›s âœï¸</span>
      </div>
      <div id="wi-rows" style="max-height:460px;overflow-y:auto"></div>
    </div>
    <div>
      <div class="card" style="margin-bottom:16px">
        <div class="ct">ğŸ“Š VÃ½sledek scÃ©nÃ¡Å™e</div>
        <div id="sc-results"></div>
      </div>
      <div class="card">
        <div class="ct">ğŸ’¬ AI interpretace</div>
        <div id="ai-interp" style="font-size:12px;line-height:1.6;color:var(--dim);font-style:italic">Uprav hodnoty vlevo...</div>
      </div>
    </div>
  </div>
</div>

<!-- PANEL 3: CASH FLOW -->
<div id="p-cashflow" class="panel">
  <div class="g2">
    <div class="card">
      <div class="ct">ğŸ“ˆ Predikce pÅ™Ã­jmÅ¯ â€” 12 mÄ›sÃ­cÅ¯</div>
      <div class="cf-wrap" id="cf-chart"></div>
      <div style="display:flex;gap:14px;margin-top:6px;font-size:10px;color:var(--dim)">
        <span style="display:flex;align-items:center;gap:5px"><span style="width:10px;height:10px;background:rgba(0,200,240,.4);border-radius:2px"></span>PÅ™Ã­jmy</span>
        <span style="display:flex;align-items:center;gap:5px"><span style="width:10px;height:10px;background:rgba(15,212,148,.5);border-radius:2px"></span>Zisk</span>
      </div>
    </div>
    <div class="card"><div class="ct">ğŸ“… SezÃ³nnÃ­ analÃ½za</div><div id="cf-season"></div></div>
  </div>
  <div class="card">
    <div class="ct">ğŸ“‹ MÄ›sÃ­ÄnÃ­ tabulka</div>
    <table class="ptable">
      <thead><tr><th>MÄ›sÃ­c</th><th>SezÃ³na</th><th>PÅ™Ã­jmy</th><th>NÃ¡klady</th><th>Zisk</th><th>Kum. YTD</th><th>vs. zÃ¡klad</th></tr></thead>
      <tbody id="cf-tbody"></tbody>
    </table>
  </div>
</div>

<!-- PANEL 4: BUDDY CHAT -->
<div id="p-buddy" class="panel">
  <div class="g2">
    <div class="bw">
      <div class="bh">
        <div class="bav">&#x1F916;</div>
        <div><div class="bhn">Buddy â€” DentVantage AI</div><div class="bhs" id="b-status">â— Online Â· FinanÄnÃ­ agent pÅ™ipojen</div></div>
      </div>
      <div class="bmsgs" id="bmsgs">
        <div class="msg">
          <div class="mav b">&#x1F916;</div>
          <div class="mb">DobrÃ½ den! &#x1F44B; Jsem Buddy, vÃ¡Å¡ AI prÅ¯vodce.<br><br>
            MÃ¡m pÅ™Ã­stup k <span class="hb">FinanÄnÃ­mu agentovi v3</span>.<br><br>
            Eviduji <span class="hr">5 ztrÃ¡tovÃ½ch procedur</span> a roÄnÃ­ potenciÃ¡l <span class="hg">+127 308 KÄ</span>.</div>
        </div>
      </div>
      <div class="qqs">
        <div class="qq" onclick="sq(this)">ğŸ“Š Jak si vedu?</div>
        <div class="qq" onclick="sq(this)">ğŸ’° Jsou ceny OK?</div>
        <div class="qq" onclick="sq(this)">â­ ZlatÃ© procedury</div>
        <div class="qq" onclick="sq(this)">ğŸ“ˆ Cash flow Q2</div>
        <div class="qq" onclick="sq(this)">ğŸ”º Co zdraÅ¾it prvnÃ­?</div>
      </div>
      <div class="bir">
        <input class="bi" id="bi" placeholder="Zeptejte se Buddyhoâ€¦" onkeydown="if(event.key==='Enter')sm()">
        <button class="sbtn" onclick="sm()">Odeslat â†’</button>
      </div>
    </div>
    <div>
      <div class="card" style="margin-bottom:16px">
        <div class="ct">ğŸ”Œ API Bridge Status</div><div id="bridge-detail"></div>
      </div>
      <div class="card">
        <div class="ct">âš¡ PoslednÃ­ volÃ¡nÃ­</div>
        <pre id="last-call" style="font-family:var(--fm);font-size:10px;color:var(--dim)">ÄŒekÃ¡m na dotazâ€¦</pre>
      </div>
    </div>
  </div>
</div>

<!-- PANEL 5: API LOG -->
<div id="p-apilog" class="panel">
  <div class="g2">
    <div>
      <div class="card" style="margin-bottom:16px">
        <div class="ct">ğŸ“¡ API Endpointy</div><div id="ep-list"></div>
      </div>
      <div class="card">
        <div class="ct">ğŸ§ª Test endpoint Å¾ivÄ›</div>
        <div style="display:flex;flex-direction:column;gap:10px">
          <select id="test-ep" style="background:var(--surf2);border:1px solid var(--border);border-radius:8px;padding:9px 12px;color:var(--white);font-size:12px;outline:none">
            <option value="overview">POST /api/financial/overview</option>
            <option value="profitability">POST /api/financial/profitability</option>
            <option value="cashflow">POST /api/financial/cashflow</option>
            <option value="scenario">POST /api/financial/scenario</option>
            <option value="ask">POST /api/financial/ask</option>
          </select>
          <textarea id="test-body" rows="3" style="background:var(--surf2);border:1px solid var(--border);border-radius:8px;padding:9px 12px;color:var(--white);font-family:var(--fm);font-size:11px;resize:vertical;outline:none">{"practice_id":"pavel","session_id":"test-001"}</textarea>
          <button onclick="testEP()" style="background:var(--blue);border:none;border-radius:8px;padding:10px;color:#000;font-weight:700;cursor:pointer;font-family:var(--ff)">â–¶ Spustit test</button>
        </div>
      </div>
    </div>
    <div>
      <div class="alog">
        <div class="alogh"><span style="color:var(--green)">â—</span> LIVE API LOG<span style="margin-left:auto;cursor:pointer;color:var(--blue)" onclick="clLog()">Vymazat</span></div>
        <div class="alogb" id="alogb"></div>
      </div>
    </div>
  </div>
  <div class="card" style="margin-top:16px">
    <div class="ct">ğŸ“¤ OdpovÄ›Ä API</div>
    <pre id="api-resp" style="font-family:var(--fm);font-size:10px;color:var(--green);line-height:1.5;max-height:280px;overflow-y:auto;white-space:pre-wrap">SpusÅ¥ test vÃ½Å¡eâ€¦</pre>
  </div>
</div>

</div><!-- /wrap -->

<script>
const PROCS=[
  {id:'P01',n:'VstupnÃ­ vyÅ¡etÅ™enÃ­',    cat:'prevence',    td:30, cost:2040, price:2000, rec:2652},
  {id:'P02',n:'Extrakce',             cat:'chirurgie',   td:30, cost:2125, price:1800, rec:2763},
  {id:'P03',n:'Extrakce chirurgickÃ¡', cat:'chirurgie',   td:45, cost:3870, price:3500, rec:5031},
  {id:'P04',n:'ImplantÃ¡t + korunka',  cat:'implantologie',td:105,cost:19530,price:33000,rec:25389},
  {id:'P05',n:'VÃ½plÅˆ 1 ploÅ¡ka',       cat:'konzervativa',td:30, cost:2215, price:1500, rec:2880},
  {id:'P06',n:'VÃ½plÅˆ 2 ploÅ¡ky',       cat:'konzervativa',td:30, cost:2265, price:2000, rec:2945},
  {id:'P07',n:'VÃ½plÅˆ 3 ploÅ¡ky',       cat:'konzervativa',td:30, cost:2295, price:2500, rec:2984},
  {id:'P08',n:'Endodoncie 1kk',       cat:'endodoncie',  td:30, cost:2695, price:4500, rec:3504},
  {id:'P09',n:'Endodoncie 2kk',       cat:'endodoncie',  td:35, cost:3053, price:5000, rec:3969},
  {id:'P10',n:'Endodoncie 3kk',       cat:'endodoncie',  td:40, cost:3447, price:6600, rec:4481},
  {id:'P11',n:'BÄ›lenÃ­ zubÅ¯',          cat:'estetika',    td:15, cost:5015, price:6500, rec:6520},
  {id:'P12',n:'CelokeramickÃ¡ korunka',cat:'protetika',   td:90, cost:10405,price:12500,rec:13527},
  {id:'P13',n:'MTK korunka',          cat:'protetika',   td:90, cost:10405,price:12500,rec:13527},
  {id:'P14',n:'CelkovÃ¡ snÃ­m. nÃ¡hrada',cat:'protetika',   td:75, cost:10180,price:12500,rec:13234},
  {id:'P15',n:'ÄŒÃ¡steÄnÃ¡ snÃ­m. nÃ¡hrada',cat:'protetika',  td:75, cost:9080, price:10500,rec:11804},
  {id:'P16',n:'VstupnÃ­ vyÅ¡. (spec.)', cat:'prevence',    td:30, cost:1955, price:2000, rec:2542},
];
const DVOLS={P01:40,P02:15,P03:8,P04:3,P05:25,P06:20,P07:15,P08:8,P09:5,P10:5,P11:4,P12:6,P13:4,P14:2,P15:2,P16:20};
const FIXED=85000;
const SEASON=[0.92,1.00,1.05,1.08,1.02,0.95,0.72,0.80,1.05,1.10,1.12,0.85];
const MNS=['Led','Ãšno','BÅ™e','Dub','KvÄ›','ÄŒvn','ÄŒvc','Srp','ZÃ¡Å™','Å˜Ã­j','Lis','Pro'];
const API='http://localhost:8000';
let CP={},CV={},logs=[];
PROCS.forEach(p=>{CP[p.id]=p.price;CV[p.id]=DVOLS[p.id]||5});

function cp(p,price){const m=price>0?(price-p.cost)/price*100:0;const kph=p.td>0?price/p.td*60:0;
  const g=m>=40?'ZLATÃ':m>=15?'DOBRÃ':m>=0?'PRÅ®MÄšR':'ZTRÃTOVÃ';return{m,kph,g,profit:price-p.cost}}
function snap(prices,vols){
  let r=0,c=0;PROCS.forEach(p=>{const pr=prices[p.id]||p.price;const v=vols[p.id]||0;r+=pr*v;c+=p.cost*v});
  const profit=r-c-FIXED;return{r,c,profit,margin:r>0?profit/r*100:0}}
function calcCF(n=12){
  const b=snap(CP,CV);const now=new Date();let cum=0;
  return Array.from({length:n},(_,i)=>{
    const mi=(now.getMonth()+i)%12;const yr=now.getFullYear()+Math.floor((now.getMonth()+i)/12);
    const s=SEASON[mi];const g=Math.pow(1.05,i/12);
    const r=Math.round(b.r*s*g);const c=Math.round((b.c+FIXED)*g);const profit=r-c;cum+=profit;
    return{label:`${MNS[mi]} ${yr}`,sh:MNS[mi],s,r,c,profit,cum,vs:(r/b.r-1)*100}});}
function gc(g){return{ZLATÃ:'var(--gold)',DOBRÃ:'var(--green)',PRÅ®MÄšR:'var(--dim)',ZTRÃTOVÃ:'var(--red)'}[g]}
function gb(g){return{ZLATÃ:'b-gold',DOBRÃ:'b-green',PRÅ®MÄšR:'b-avg',ZTRÃTOVÃ:'b-red'}[g]}
function fkc(n){return n.toLocaleString('cs-CZ')}
function updKPIs(){
  const s=snap(CP,CV);
  document.getElementById('k-rev').textContent=fkc(s.r)+' KÄ';
  const pe=document.getElementById('k-profit');pe.textContent=fkc(s.profit)+' KÄ';pe.style.color=s.profit>=0?'var(--green)':'var(--red)';
  document.getElementById('k-margin').textContent=s.margin.toFixed(1)+'%';
  document.getElementById('k-alerts').textContent=PROCS.filter(p=>CP[p.id]<p.cost).length;
}

// PANEL 1
function renderOverview(){
  const sorted=[...PROCS].map(p=>({...p,...cp(p,CP[p.id])})).sort((a,b)=>b.kph-a.kph);
  const golden=sorted.filter(p=>p.g==='ZLATÃ');const loss=sorted.filter(p=>p.g==='ZTRÃTOVÃ');
  const maxR=Math.max(...sorted.map(p=>p.price*(DVOLS[p.id]||1)));
  document.getElementById('golden-list').innerHTML=golden.length
    ?golden.map(p=>`<div class="ins"><div class="ii ii-gld">â­</div><div>
      <div class="il">${fkc(Math.round(p.kph))} KÄ/hod</div>
      <div class="it">${p.n} Â· marÅ¾e ${p.m.toFixed(1)}%</div></div></div>`).join('')
    :'<div style="color:var(--dim);font-size:12px">Å½Ã¡dnÃ© zlatÃ© procedury</div>';
  document.getElementById('loss-list').innerHTML=loss.map(p=>`<div class="ins">
    <div class="ii ii-r">ğŸš¨</div><div>
    <div class="il">ZtrÃ¡ta ${fkc(Math.abs(Math.round(p.profit)))} KÄ/vÃ½kon</div>
    <div class="it">${p.n} Â· marÅ¾e ${p.m.toFixed(1)}% Â· doporuÄ. ${fkc(p.rec)} KÄ</div>
    </div></div>`).join('');
  document.getElementById('dist-bars').innerHTML=sorted.slice(0,8).map(p=>`
    <div style="margin-bottom:9px">
      <div style="display:flex;justify-content:space-between;margin-bottom:4px">
        <span style="font-size:11px">${p.n.substring(0,24)}</span>
        <span style="font-family:var(--fm);font-size:9px;color:${gc(p.g)}">${p.g}</span>
      </div>
      <div class="mbar"><div class="mbar-bg"><div class="mbar-fill" style="width:${Math.max(2,(p.price*(DVOLS[p.id]||1)/maxR*100)).toFixed(0)}%;background:${gc(p.g)}"></div></div>
      <div class="mv" style="color:${gc(p.g)}">${p.m.toFixed(0)}%</div></div>
    </div>`).join('');
  document.getElementById('proc-tbody').innerHTML=sorted.map((p,i)=>`<tr>
    <td class="mn" style="color:var(--dim)">${i+1}</td>
    <td><div class="pn" style="color:${gc(p.g)}">${p.n}</div><span class="pcat">${p.cat}</span></td>
    <td class="mn">${fkc(CP[p.id])} KÄ</td>
    <td class="mn" style="color:var(--dim)">${fkc(p.cost)} KÄ</td>
    <td><div class="mbar"><div class="mbar-bg"><div class="mbar-fill" style="width:${Math.max(0,Math.min(100,p.m)).toFixed(0)}%;background:${gc(p.g)}"></div></div>
    <div class="mv" style="color:${gc(p.g)}">${p.m.toFixed(1)}%</div></div></td>
    <td class="mn" style="color:var(--blue);font-weight:500">${fkc(Math.round(p.kph))} KÄ</td>
    <td><span class="badge ${gb(p.g)}">${p.g}</span></td>
  </tr>`).join('');
  updKPIs();
}

// PANEL 2
function renderWhatIf(){
  document.getElementById('wi-rows').innerHTML=PROCS.map(p=>`
    <div class="proc-row">
      <div class="prn">${p.n}<span class="prc">${p.cat} Â· nÃ¡kl. ${fkc(p.cost)} KÄ Â· doporuÄ. ${fkc(p.rec)} KÄ</span></div>
      <input type="number" class="pi" id="wi-p-${p.id}" value="${CP[p.id]}" oninput="updSc()" min="0" step="100">
      <input type="number" class="vi" id="wi-v-${p.id}" value="${CV[p.id]}" oninput="updSc()" min="0" step="1" style="margin-left:8px">
    </div>`).join('');
  updSc();
}
let scTmr=null;
function updSc(){
  PROCS.forEach(p=>{
    const pe=document.getElementById(`wi-p-${p.id}`);const ve=document.getElementById(`wi-v-${p.id}`);
    if(pe)CP[p.id]=parseFloat(pe.value)||0;if(ve)CV[p.id]=parseInt(ve.value)||0;
  });
  const base=snap(Object.fromEntries(PROCS.map(p=>[p.id,p.price])),DVOLS);
  const sc=snap(CP,CV);const dp=sc.profit-base.profit;
  const pc=sc.profit>=0?'var(--green)':'var(--red)';const dc=dp>0?'dp':dp<0?'dn':'d0';
  document.getElementById('sc-results').innerHTML=`
    <div class="rkpi"><div class="rkl">MÄ›sÃ­ÄnÃ­ pÅ™Ã­jmy scÃ©nÃ¡Å™e</div><div class="rkv" style="color:var(--blue)">${fkc(sc.r)} KÄ</div></div>
    <div class="rkpi"><div class="rkl">MÄ›sÃ­ÄnÃ­ zisk scÃ©nÃ¡Å™e</div><div class="rkv" style="color:${pc}">${fkc(sc.profit)} KÄ</div></div>
    <div class="dr"><span class="dl">vs. zÃ¡klad â€” mÄ›sÃ­ÄnÄ›</span><span class="dv ${dc}">${dp>=0?'+':''}${fkc(dp)} KÄ</span></div>
    <div class="dr"><span class="dl">vs. zÃ¡klad â€” roÄnÄ›</span><span class="dv ${dc}">${dp>=0?'+':''}${fkc(dp*12)} KÄ</span></div>
    <div class="dr"><span class="dl">PrÅ¯mÄ›rnÃ¡ marÅ¾e</span><span class="dv d0">${sc.margin.toFixed(1)}%</span></div>`;
  updKPIs();
  clearTimeout(scTmr);scTmr=setTimeout(()=>aiInterp(dp,sc,base),600);
  logAPI('POST','/api/financial/scenario',200,Math.floor(Math.random()*80+20));
}
function aiInterp(dp,sc,base){
  const el=document.getElementById('ai-interp');
  const changed=PROCS.filter(p=>CP[p.id]!==p.price||CV[p.id]!==DVOLS[p.id]);
  if(!changed.length){el.style.color='var(--dim)';el.style.fontStyle='italic';el.textContent='Uprav hodnoty vlevoâ€¦';return}
  let msg='';
  if(dp>50000)msg=`ğŸš€ VÃ½bornÄ›! +${fkc(dp*12)} KÄ/rok navÃ­c. Tento scÃ©nÃ¡Å™ eliminuje ztrÃ¡tovÃ© vÃ½kony a vÃ½raznÄ› zlepÅ¡uje ziskovost. DoporuÄuji implementovat postupnÄ›, nejprve zdraÅ¾enÃ­ o 10â€“15 %.`;
  else if(dp>0)msg=`âœ… PozitivnÃ­ scÃ©nÃ¡Å™: +${fkc(dp*12)} KÄ/rok. ${sc.profit<0?'Praxe stÃ¡le ve ztrÃ¡tÄ› â€” zvaÅ¾te agresivnÄ›jÅ¡Ã­ optimalizaci.':'Praxe v zisku. DalÅ¡Ã­ krok: navÃ½Å¡it objem zlatÃ½ch procedur.'}`;
  else if(dp<0)msg=`âš ï¸ Tento scÃ©nÃ¡Å™ sniÅ¾uje zisk o ${fkc(Math.abs(dp*12))} KÄ/rok. Zkontrolujte, zda niÅ¾Å¡Ã­ ceny pÅ™inesou dostateÄnÃ½ nÃ¡rÅ¯st poptÃ¡vky.`;
  else msg=`ğŸ“Š NeutrÃ¡lnÃ­ scÃ©nÃ¡Å™. Zkuste upravit vÃ½plnÄ› na doporuÄenÃ© ceny (2 880+ KÄ).`;
  el.style.color='var(--white)';el.style.fontStyle='normal';el.textContent=msg;
}

// PANEL 3
function renderCashflow(){
  const cf=calcCF(12);const maxR=Math.max(...cf.map(m=>m.r));let cumYTD=0;
  document.getElementById('cf-chart').innerHTML=cf.map(m=>{
    const rh=Math.round(m.r/maxR*130);const ph=Math.round(Math.abs(m.profit)/maxR*130);
    const pc=m.profit>=0?'rgba(15,212,148,.55)':'rgba(244,63,94,.4)';
    const pbc=m.profit>=0?'rgba(15,212,148,.6)':'rgba(244,63,94,.5)';
    return`<div class="cf-col">
      <div class="cf-bw" style="height:${rh}px">
        <div class="cf-tt">${m.label}<br>${fkc(m.r)} KÄ<br>Zisk: ${fkc(m.profit)} KÄ</div>
        <div class="cf-br" style="height:${rh}px"></div>
        <div class="cf-bp" style="height:${ph}px;background:${pc};border:1px solid ${pbc}"></div>
      </div>
      <div class="cf-mo">${m.sh}</div>
    </div>`;}).join('');
  const worst=cf.reduce((a,b)=>a.r<b.r?a:b);const best=cf.reduce((a,b)=>a.r>b.r?a:b);
  document.getElementById('cf-season').innerHTML=`
    <div class="ins"><div class="ii ii-g">ğŸ“ˆ</div><div>
      <div class="il">NejsilnÄ›jÅ¡Ã­ mÄ›sÃ­c</div>
      <div class="it">${best.label} Â· ${fkc(best.r)} KÄ Â· Ã—${best.s.toFixed(2)}<br>
      IdeÃ¡lnÃ­ pro implantÃ¡ty a protetiku.</div></div></div>
    <div class="ins"><div class="ii ii-r">ğŸ“‰</div><div>
      <div class="il">NejslabÅ¡Ã­ mÄ›sÃ­c</div>
      <div class="it">${worst.label} Â· ${fkc(worst.r)} KÄ Â· Ã—${worst.s.toFixed(2)}<br>
      PlÃ¡nujte dovolenÃ© a investice.</div></div></div>
    <div class="ins"><div class="ii ii-b">ğŸ’¡</div><div>
      <div class="il">RoÄnÃ­ celkem</div>
      <div class="it">PÅ™Ã­jmy ${fkc(cf.reduce((s,m)=>s+m.r,0))} KÄ<br>
      Zisk ${fkc(cf.reduce((s,m)=>s+m.profit,0))} KÄ</div></div></div>`;
  document.getElementById('cf-tbody').innerHTML=cf.map(m=>{
    cumYTD+=m.profit;const pc=m.profit>=0?'var(--green)':'var(--red)';const vc=m.vs>=0?'var(--green)':'var(--red)';
    return`<tr>
      <td class="mn">${m.label}</td>
      <td class="mn" style="color:${m.s>=1?'var(--green)':'var(--red)'}">Ã—${m.s.toFixed(2)}</td>
      <td class="mn" style="color:var(--blue)">${fkc(m.r)} KÄ</td>
      <td class="mn" style="color:var(--dim)">${fkc(m.c)} KÄ</td>
      <td class="mn" style="color:${pc}">${fkc(m.profit)} KÄ</td>
      <td class="mn" style="color:var(--purple)">${fkc(cumYTD)} KÄ</td>
      <td class="mn" style="color:${vc}">${m.vs>=0?'+':''}${m.vs.toFixed(1)}%</td></tr>`;}).join('');
}

// PANEL 4 â€“ BUDDY CHAT
const BR={
  'jak si vedu':()=>{const s=snap(CP,CV);const l=PROCS.filter(p=>CP[p.id]<p.cost);
    return`ğŸ“Š PÅ™ehled praxe:<br><br>ğŸ’° PÅ™Ã­jmy: <span class="hb">${fkc(s.r)} KÄ</span><br>âœ… Zisk: <span class="${s.profit>=0?'hg':'hr'}">${fkc(s.profit)} KÄ</span><br>ğŸ“ˆ MarÅ¾e: <span class="hgld">${s.margin.toFixed(1)}%</span><br><br>ğŸš¨ ZtrÃ¡tovÃ½ch: <span class="hr">${l.length}</span><br>ğŸ’¡ RoÄnÃ­ potenciÃ¡l: <span class="hg">+127 308 KÄ</span>`;},
  'ceny':()=>{const l=PROCS.filter(p=>CP[p.id]<p.cost);
    return`âš ï¸ Nalezeno <span class="hr">${l.length} ztrÃ¡tovÃ½ch procedur</span>:<br><br>${l.map(p=>`â€¢ <strong>${p.n}</strong>: ${fkc(CP[p.id])} â†’ doporuÄ. <span class="hg">${fkc(p.rec)} KÄ</span>`).join('<br>')}<br><br>OkamÅ¾itÃ¡ akce: zdraÅ¾te vÃ½plnÄ› na min. 2 900 KÄ.`;},
  'zlatÃ©':()=>{const g=[...PROCS].map(p=>({...p,...cp(p,CP[p.id])})).filter(p=>p.g==='ZLATÃ').sort((a,b)=>b.kph-a.kph);
    return`â­ ZlatÃ© procedury:<br><br>${g.map(p=>`â€¢ <strong>${p.n}</strong>: marÅ¾e <span class="hgld">${p.m.toFixed(1)}%</span> Â· <span class="hb">${fkc(Math.round(p.kph))} KÄ/hod</span>`).join('<br>')}<br><br>ğŸ’¡ NavyÅ¡te jejich objem.`;},
  'cash':()=>{const cf=calcCF(6);const w=cf.reduce((a,b)=>a.r<b.r?a:b);const bst=cf.reduce((a,b)=>a.r>b.r?a:b);
    return`ğŸ“ˆ Cash flow predikce:<br><br>${cf.slice(0,6).map(m=>`â€¢ <strong>${m.label}</strong>: <span class="${m.s>=1?'hg':'hgld'}">${fkc(m.r)} KÄ</span>`).join('<br>')}<br><br>ğŸ“… NejlepÅ¡Ã­: <span class="hg">${bst.label}</span> Â· NejslabÅ¡Ã­: <span class="hr">${w.label}</span>`;},
  'zdraÅ¾it':()=>`ğŸ¯ PoÅ™adÃ­ zdraÅ¾enÃ­:<br><br>1. <strong>VÃ½plÅˆ 1 ploÅ¡ka</strong>: 1 500 â†’ <span class="hg">2 900 KÄ</span><br>2. <strong>VÃ½plÅˆ 2 ploÅ¡ky</strong>: 2 000 â†’ <span class="hg">3 000 KÄ</span><br>3. <strong>Extrakce</strong>: 1 800 â†’ <span class="hg">2 763 KÄ</span><br><br>Dopad: <span class="hg">+55 000 KÄ/mÄ›s, +660 000 KÄ/rok</span>`,
};
function matchR(msg){
  const m=msg.toLowerCase();
  if(m.includes('jak si')||m.includes('pÅ™ehled')||m.includes('financ'))return BR['jak si vedu']();
  if(m.includes('cen')||m.includes('cenÃ­k')||m.includes('ok'))return BR['ceny']();
  if(m.includes('zlat')||m.includes('ziskovost')||m.includes('nejzisnÄ›jÅ¡')||m.includes('nejziskovÄ›jÅ¡'))return BR['zlatÃ©']();
  if(m.includes('cash')||m.includes('predikce')||m.includes('q2')||m.includes('q3'))return BR['cash']();
  if(m.includes('zdraÅ¾it')||m.includes('prvnÃ­')||m.includes('priorit'))return BR['zdraÅ¾it']();
  const s=snap(CP,CV);return`Dotaz: "<em>${msg}</em>"<br><br>Stav: pÅ™Ã­jmy <span class="hb">${fkc(s.r)} KÄ</span>, zisk <span class="${s.profit>=0?'hg':'hr'}">${fkc(s.profit)} KÄ</span>.<br>Zkuste konkrÃ©tnÄ›jÅ¡Ã­ dotaz.`;
}
function addMsg(html,u=false){
  const c=document.getElementById('bmsgs');const d=document.createElement('div');
  d.className='msg'+(u?' user':'');
  d.innerHTML=`<div class="mav ${u?'u':'b'}">${u?'ğŸ‘¤':'ğŸ¤–'}</div><div class="mb">${html}</div>`;
  c.appendChild(d);c.scrollTop=c.scrollHeight;
}
function addTyp(){
  const c=document.getElementById('bmsgs');const d=document.createElement('div');
  d.id='typ';d.className='msg';
  d.innerHTML='<div class="mav b">ğŸ¤–</div><div class="mb"><div class="typ"><span></span><span></span><span></span></div></div>';
  c.appendChild(d);c.scrollTop=c.scrollHeight;
}
function sq(el){const q=el.textContent;addMsg(q,true);addTyp();
  logAPI('POST','/api/financial/ask',200,Math.floor(Math.random()*120+40));
  document.getElementById('last-call').textContent=`POST /api/financial/ask\n{"message":"${q}"}`;
  setTimeout(()=>{document.getElementById('typ')?.remove();addMsg(matchR(q))},800+Math.random()*500);}
function sm(){const i=document.getElementById('bi');const t=i.value.trim();if(!t)return;
  i.value='';addMsg(t,true);addTyp();
  logAPI('POST','/api/financial/ask',200,Math.floor(Math.random()*120+40));
  document.getElementById('last-call').textContent=`POST /api/financial/ask\n{"message":"${t}"}`;
  setTimeout(()=>{document.getElementById('typ')?.remove();addMsg(matchR(t))},800+Math.random()*600);}
function renderBridge(){
  document.getElementById('bridge-detail').innerHTML=`
    <div class="dr"><span class="dl">API Server</span><span class="dv" style="color:var(--gold)">localhost:8000</span></div>
    <div class="dr"><span class="dl">Status</span><span class="dv" id="br-st" style="color:var(--dim)">Kontrolujiâ€¦</span></div>
    <div class="dr"><span class="dl">Endpointy</span><span class="dv dp">7 aktivnÃ­ch</span></div>
    <div class="dr"><span class="dl">Data</span><span class="dv dp">16 procedur</span></div>
    <div class="dr"><span class="dl">AI (Claude)</span><span class="dv" style="color:var(--gold)">VyÅ¾aduje API klÃ­Ä</span></div>`;
  chkAPI();}

// PANEL 5 â€“ API LOG
function logAPI(m,p,s,ms){
  const t=new Date().toLocaleTimeString('cs-CZ',{hour:'2-digit',minute:'2-digit',second:'2-digit'});
  logs.unshift({t,m,p,s,ms});if(logs.length>60)logs.pop();renderLog();}
function renderLog(){
  const b=document.getElementById('alogb');if(!b)return;
  b.innerHTML=logs.map(e=>`<div class="le">
    <span class="lt">${e.t}</span><span class="lm ${e.m==='POST'?'lm-p':'lm-g'}">${e.m}</span>
    <span class="lpath">${e.p}</span><span class="lst">${e.s}</span><span class="lms">${e.ms}ms</span>
  </div>`).join('');}
function clLog(){logs=[];renderLog();}
function renderEPs(){
  const eps=[
    {m:'GET',p:'/health',d:'Stav agenta'},
    {m:'POST',p:'/api/financial/overview',d:'KPI snapshot'},
    {m:'POST',p:'/api/financial/profitability',d:'AnalÃ½za ziskovosti'},
    {m:'POST',p:'/api/financial/scenario',d:'What-If scÃ©nÃ¡Å™'},
    {m:'POST',p:'/api/financial/cashflow',d:'Predikce cash flow'},
    {m:'POST',p:'/api/financial/alert',d:'InteligentnÃ­ upozornÄ›nÃ­'},
    {m:'POST',p:'/api/financial/ask',d:'PÅ™irozenÃ½ jazyk'},
  ];
  document.getElementById('ep-list').innerHTML=eps.map(e=>`<div class="dr">
    <span class="dl" style="display:flex;align-items:center;gap:7px">
      <span class="lm ${e.m==='POST'?'lm-p':'lm-g'}" style="font-size:8px">${e.m}</span>
      <span class="mn" style="font-size:11px;color:var(--white)">${e.p}</span></span>
    <span style="font-size:11px;color:var(--dim)">${e.d}</span></div>`).join('');}
async function testEP(){
  const ep=document.getElementById('test-ep').value;const body=document.getElementById('test-body').value;
  const re=document.getElementById('api-resp');const t0=Date.now();
  re.style.color='var(--dim)';re.textContent='VolÃ¡m APIâ€¦';
  try{
    let result;const parsed=JSON.parse(body);
    if(ep==='overview'){const s=snap(CP,CV);result={ok:true,type:'overview',
      buddy_response:`PÅ™Ã­jmy ${fkc(s.r)} KÄ, zisk ${fkc(s.profit)} KÄ, marÅ¾e ${s.margin.toFixed(1)}%`,
      data:{kpis:s,alerts:PROCS.filter(p=>CP[p.id]<p.cost).map(p=>({procedure:p.n}))}};}
    else if(ep==='profitability'){const sorted=[...PROCS].map(p=>({...p,...cp(p,CP[p.id])})).sort((a,b)=>b.kph-a.kph);
      result={ok:true,type:'profitability',buddy_response:`ZlatÃ©: ${sorted.filter(p=>p.g==='ZLATÃ').map(p=>p.n).join(', ')}`,data:{golden:sorted.filter(p=>p.g==='ZLATÃ').map(p=>({name:p.n,margin:p.m.toFixed(1),kph:Math.round(p.kph)}))}};}
    else if(ep==='cashflow'){const cf=calcCF(6);result={ok:true,type:'cashflow',
      buddy_response:`6M pÅ™Ã­jmy: ${fkc(cf.reduce((s,m)=>s+m.r,0))} KÄ`,
      data:{months:cf.slice(0,3),summary:{total_revenue:cf.reduce((s,m)=>s+m.r,0),total_profit:cf.reduce((s,m)=>s+m.profit,0)}}};}
    else if(ep==='scenario'){const s=snap(CP,CV);const b=snap(Object.fromEntries(PROCS.map(p=>[p.id,p.price])),DVOLS);
      const dp=s.profit-b.profit;result={ok:true,type:'scenario',
      buddy_response:`Dopad: ${dp>=0?'+':''}${fkc(dp)} KÄ/mÄ›s`,
      data:{delta:{monthly_profit:Math.round(dp),annual_profit:Math.round(dp*12)}}};}
    else if(ep==='ask'){const msg=parsed.message||'Jak si vedu?';result={ok:true,type:'general',buddy_response:matchR(msg).replace(/<[^>]+>/g,''),data:null};}
    const ms=Date.now()-t0+Math.floor(Math.random()*60);
    logAPI('POST',`/api/financial/${ep}`,200,ms);
    re.style.color='var(--green)';re.textContent=JSON.stringify(result,null,2);
  }catch(e){re.style.color='var(--red)';re.textContent=`Chyba: ${e.message}`;logAPI('POST',`/api/financial/${ep}`,400,Date.now()-t0);}}

// API STATUS
async function chkAPI(){
  const led=document.getElementById('led');const txt=document.getElementById('api-txt');const br=document.getElementById('br-st');
  try{const r=await fetch(`${API}/health`,{signal:AbortSignal.timeout(1500)});
    if(r.ok){led.classList.add('on');txt.textContent='API online';txt.style.color='var(--green)';
      if(br){br.textContent='âœ… Online';br.style.color='var(--green)'}logAPI('GET','/health',200,12);return;}}
  catch(e){}
  led.classList.remove('on');txt.textContent='API offline â€” demo mÃ³d';txt.style.color='var(--dim)';
  if(br){br.textContent='âš¡ Demo mÃ³d (spusÅ¥ api_server.py)';br.style.color='var(--gold)';}}

// TAB SWITCH
function sw(name,el){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
  el.classList.add('active');document.getElementById(`p-${name}`).classList.add('active');
  if(name==='overview')renderOverview();
  if(name==='whatif')renderWhatIf();
  if(name==='cashflow')renderCashflow();
  if(name==='buddy')renderBridge();
  if(name==='apilog'){renderEPs();renderLog();}
}

// INIT
document.addEventListener('DOMContentLoaded',()=>{
  renderOverview();chkAPI();setInterval(chkAPI,10000);
  setTimeout(()=>logAPI('GET','/health',200,8),100);
  setTimeout(()=>logAPI('POST','/api/financial/overview',200,142),300);
  setTimeout(()=>logAPI('POST','/api/financial/profitability',200,89),500);
});
</script>
</body>
</html>